{
  "$schema": "./schemas/platforms-v1.json",

  // Global flows that apply to all platforms
  "global": {
    "export": [
      {
        "from": "AGENTS.md",
        "to": "AGENTS.md",
        "when": { "exists": "AGENTS.md" },
        "merge": "composite"
      }
    ],
    "import": [
      {
        "from": "AGENTS.md",
        "to": "AGENTS.md",
        "merge": "composite"
      }
    ]
  },

  // Platform definitions for all supported AI coding platforms
  // Each platform defines export flows (package → workspace) and import flows (workspace → package)

  "antigravity": {
    "name": "Google Antigravity",
    "rootDir": ".agent",
    "export": [
      {
        "from": "rules/**/*.md",
        "to": ".agent/rules/**/*.md"
      },
      {
        "from": "commands/**/*.md",
        "to": ".agent/workflows/**/*.md"
      }
    ],
    "import": [
      {
        "from": ".agent/rules/**/*.md",
        "to": "rules/**/*.md"
      },
      {
        "from": ".agent/workflows/**/*.md",
        "to": "commands/**/*.md"
      }
    ]
  },

  "augment": {
    "name": "Augment Code",
    "rootDir": ".augment",
    "export": [
      {
        "from": "rules/**/*.md",
        "to": ".augment/rules/**/*.md"
      },
      {
        "from": "commands/**/*.md",
        "to": ".augment/commands/**/*.md"
      }
    ],
    "import": [
      {
        "from": ".augment/rules/**/*.md",
        "to": "rules/**/*.md"
      },
      {
        "from": ".augment/commands/**/*.md",
        "to": "commands/**/*.md"
      }
    ]
  },

  "claude": {
    "name": "Claude Code",
    "rootDir": ".claude",
    "rootFile": "CLAUDE.md",
    "aliases": ["claudecode"],
    "export": [
      {
        "from": "AGENTS.md",
        "to": "CLAUDE.md",
        "merge": "composite"
      },
      {
        "from": "rules/**/*.md",
        "to": ".claude/rules/**/*.md"
      },
      {
        "from": "commands/**/*.md",
        "to": ".claude/commands/**/*.md"
      },
      {
        "from": "agents/**/*.md",
        "to": ".claude/agents/**/*.md",
        "map": [
          // Set name from context
          { "$set": { "name": "$$filename" } },
          // Transform model conditionally:
          // - If it starts with "anthropic/", apply regex transformations
          // - Otherwise, set to "default"
          {
            "$transform": {
              "field": "model",
              "steps": [
                // First, check if it's an Anthropic model. If not, replace with "default"
                { "replace": { "pattern": "^(?!anthropic/).*$", "with": "default" } },
                // Then apply Anthropic transformations (these only affect anthropic/* models)
                { "replace": { "pattern": "^anthropic/", "with": "" } },
                { "replace": { "pattern": "(-[0-9]+)\\.([0-9]+)", "with": "$1-$2", "flags": "g" } }
              ]
            }
          },
          // Transform tools
          {
            "$transform": {
              "field": "tools",
              "steps": [
                { "filter": { "value": true } },
                { "keys": true },
                { "join": ", " }
              ]
            }
          },
          { "$unset": "permission" }
        ]
      },
      {
        "from": "skills/**/*",
        "to": ".claude/skills/**/*"
      },
      {
        "from": ["mcp.jsonc", "mcp.json"],
        "to": ".mcp.json",
        "pipe": ["filter-comments"],
        "map": [
          { "$rename": { "mcp": "mcpServers" } }
        ],
        "merge": "deep"
      }
    ],
    "import": [
      {
        "from": "CLAUDE.md",
        "to": "AGENTS.md",
        "merge": "composite"
      },
      {
        "from": ".claude/rules/**/*.md",
        "to": "rules/**/*.md"
      },
      {
        "from": ".claude/commands/**/*.md",
        "to": "commands/**/*.md"
      },
      {
        "from": ".claude/agents/**/*.md",
        "to": "agents/**/*.md",
        "map": [
          // Unset added fields
          { "$unset": "name" },
          // Reverse model transformation
          {
            "$transform": {
              "field": "model",
              "steps": [
                // If NOT "default", add anthropic/ prefix
                { "replace": { "pattern": "^(?!default)(.*)$", "with": "anthropic/$1" } },
                // Restore dots in version numbers
                { "replace": { "pattern": "(-[0-9]+)-([0-9]+)", "with": "$1.$2", "flags": "g" } }
              ]
            }
          },
          // Reverse tools transformation
          {
            "$transform": {
              "field": "tools",
              "steps": [
                { "split": ", " },
                { "arrayToObject": { "value": true } }
              ]
            }
          }
        ]
      },
      {
        "from": ".claude/skills/**/*",
        "to": "skills/**/*"
      },
      {
        "from": [".mcp.json", ".mcp.jsonc"],
        "to": "mcp.jsonc",
        "map": [
          { "$rename": { "mcpServers": "mcp" } }
        ]
      }
    ]
  },

  "codex": {
    "name": "Codex CLI",
    "rootDir": ".codex",
    "rootFile": "AGENTS.md",
    "aliases": ["codexcli"],
    "export": [
      {
        "from": "commands/**/*.md",
        "to": ".codex/prompts/**/*.md"
      },
      {
        "from": ["mcp.jsonc", "mcp.json"],
        "to": ".codex/mcp-servers.toml",
        "pipe": ["filter-comments", "json-to-toml"],
        "map": [
          { "$rename": { "mcp": "mcp_servers" } }
        ],
        "merge": "deep"
      }
    ],
    "import": [
      {
        "from": ".codex/prompts/**/*.md",
        "to": "commands/**/*.md"
      },
      {
        "from": ".codex/mcp-servers.toml",
        "to": "mcp.jsonc",
        "pipe": ["toml-to-json"],
        "map": [
          { "$rename": { "mcp_servers": "mcp" } }
        ]
      }
    ]
  },

  "cursor": {
    "name": "Cursor",
    "rootDir": ".cursor",
    "rootFile": "AGENTS.md",
    "export": [
      {
        "from": "rules/**/*.md",
        "to": ".cursor/rules/**/*.mdc"
      },
      {
        "from": "commands/**/*.md",
        "to": ".cursor/commands/**/*.md"
      },
      {
        "from": "agents/**/*.md",
        "to": ".cursor/agents/**/*.md"
      },
      {
        "from": ["mcp.jsonc", "mcp.json"],
        "to": ".cursor/mcp.json",
        "pipe": ["filter-comments"],
        "map": [
          { "$rename": { "mcp": "mcpServers" } }
        ],
        "merge": "deep"
      }
    ],
    "import": [
      {
        "from": [".cursor/rules/**/*.mdc", ".cursor/rules/**/*.md"],
        "to": "rules/**/*.md"
      },
      {
        "from": ".cursor/commands/**/*.md",
        "to": "commands/**/*.md"
      },
      {
        "from": ".cursor/agents/**/*.md",
        "to": "agents/**/*.md"
      },
      {
        "from": [".cursor/mcp.json", ".cursor/mcp.jsonc"],
        "to": "mcp.jsonc",
        "map": [
          { "$rename": { "mcpServers": "mcp" } }
        ]
      }
    ]
  },

  "factory": {
    "name": "Factory AI",
    "rootDir": ".factory",
    "rootFile": "AGENTS.md",
    "export": [
      {
        "from": "commands/**/*.md",
        "to": ".factory/commands/**/*.md"
      },
      {
        "from": "agents/**/*.md",
        "to": ".factory/droids/**/*.md"
      },
      {
        "from": ["mcp.jsonc", "mcp.json"],
        "to": ".factory/settings/mcp.json",
        "pipe": ["filter-comments"],
        "map": [
          { "$rename": { "mcp": "mcpServers" } }
        ],
        "merge": "deep"
      }
    ],
    "import": [
      {
        "from": ".factory/commands/**/*.md",
        "to": "commands/**/*.md"
      },
      {
        "from": ".factory/droids/**/*.md",
        "to": "agents/**/*.md"
      },
      {
        "from": [".factory/settings/mcp.json", ".factory/settings/mcp.jsonc"],
        "to": "mcp.jsonc",
        "map": [
          { "$rename": { "mcpServers": "mcp" } }
        ]
      }
    ]
  },

  "kilo": {
    "name": "Kilo Code",
    "rootDir": ".kilocode",
    "rootFile": "AGENTS.md",
    "aliases": ["kilocode"],
    "export": [
      {
        "from": "rules/**/*.md",
        "to": ".kilocode/rules/**/*.md"
      },
      {
        "from": "commands/**/*.md",
        "to": ".kilocode/workflows/**/*.md"
      },
      {
        "from": ["mcp.jsonc", "mcp.json"],
        "to": ".kilocode/mcp.json",
        "pipe": ["filter-comments"],
        "map": [
          { "$rename": { "mcp": "mcpServers" } }
        ],
        "merge": "deep"
      }
    ],
    "import": [
      {
        "from": ".kilocode/rules/**/*.md",
        "to": "rules/**/*.md"
      },
      {
        "from": ".kilocode/workflows/**/*.md",
        "to": "commands/**/*.md"
      },
      {
        "from": [".kilocode/mcp.json", ".kilocode/mcp.jsonc"],
        "to": "mcp.jsonc",
        "map": [
          { "$rename": { "mcpServers": "mcp" } }
        ]
      }
    ]
  },

  "kiro": {
    "name": "Kiro",
    "rootDir": ".kiro",
    "export": [
      {
        "from": "rules/**/*.md",
        "to": ".kiro/steering/**/*.md"
      },
      {
        "from": ["mcp.jsonc", "mcp.json"],
        "to": ".kiro/settings/mcp.json",
        "pipe": ["filter-comments"],
        "map": [
          { "$rename": { "mcp": "mcpServers" } }
        ],
        "merge": "deep"
      }
    ],
    "import": [
      {
        "from": ".kiro/steering/**/*.md",
        "to": "rules/**/*.md"
      },
      {
        "from": [".kiro/settings/mcp.json", ".kiro/settings/mcp.jsonc"],
        "to": "mcp.jsonc",
        "map": [
          { "$rename": { "mcpServers": "mcp" } }
        ]
      }
    ]
  },

  "opencode": {
    "name": "OpenCode",
    "rootDir": ".opencode",
    "rootFile": "AGENTS.md",
    "export": [
      {
        "from": "commands/**/*.md",
        "to": ".opencode/command/**/*.md"
      },
      {
        "from": "agents/**/*.md",
        "to": ".opencode/agent/**/*.md"
      },
      {
        "from": "skills/**/*",
        "to": ".opencode/skill/**/*"
      },
      {
        "from": ["mcp.jsonc", "mcp.json"],
        "to": ".opencode/opencode.json",
        "pipe": ["filter-comments"],
        "map": [
          { "$rename": { "mcpServers": "mcp" } }
        ],
        "merge": "deep"
      }
    ],
    "import": [
      {
        "from": ".opencode/command/**/*.md",
        "to": "commands/**/*.md"
      },
      {
        "from": ".opencode/agent/**/*.md",
        "to": "agents/**/*.md"
      },
      {
        "from": ".opencode/skill/**/*",
        "to": "skills/**/*"
      },
      {
        "from": [".opencode/opencode.json", ".opencode/opencode.jsonc"],
        "to": "mcp.jsonc",
        "map": [
          { "$rename": { "mcp": "mcpServers" } }
        ]
      }
    ]
  },

  "qwen": {
    "name": "Qwen Code",
    "rootDir": ".qwen",
    "rootFile": "QWEN.md",
    "aliases": ["qwencode"],
    "export": [
      {
        "from": "AGENTS.md",
        "to": "QWEN.md",
        "merge": "composite"
      },
      {
        "from": "agents/**/*.md",
        "to": ".qwen/agents/**/*.md"
      },
      {
        "from": ["mcp.jsonc", "mcp.json"],
        "to": ".qwen/settings.json",
        "pipe": ["filter-comments"],
        "map": [
          { "$rename": { "mcp": "mcpServers" } }
        ],
        "merge": "deep"
      }
    ],
    "import": [
      {
        "from": "QWEN.md",
        "to": "AGENTS.md",
        "merge": "composite"
      },
      {
        "from": ".qwen/agents/**/*.md",
        "to": "agents/**/*.md"
      },
      {
        "from": [".qwen/settings.json", ".qwen/settings.jsonc"],
        "to": "mcp.jsonc",
        "map": [
          { "$rename": { "mcpServers": "mcp" } }
        ]
      }
    ]
  },

  "roo": {
    "name": "Roo Code",
    "rootDir": ".roo",
    "rootFile": "AGENTS.md",
    "export": [
      {
        "from": "commands/**/*.md",
        "to": ".roo/commands/**/*.md"
      },
      {
        "from": ["mcp.jsonc", "mcp.json"],
        "to": ".roo/mcp.json",
        "pipe": ["filter-comments"],
        "map": [
          { "$rename": { "mcp": "mcpServers" } }
        ],
        "merge": "deep"
      }
    ],
    "import": [
      {
        "from": ".roo/commands/**/*.md",
        "to": "commands/**/*.md"
      },
      {
        "from": [".roo/mcp.json", ".roo/mcp.jsonc"],
        "to": "mcp.jsonc",
        "map": [
          { "$rename": { "mcpServers": "mcp" } }
        ]
      }
    ]
  },

  "warp": {
    "name": "Warp",
    "rootDir": ".warp",
    "rootFile": "WARP.md",
    "export": [
      {
        "from": "AGENTS.md",
        "to": "WARP.md",
        "merge": "composite"
      }
    ],
    "import": [
      {
        "from": "WARP.md",
        "to": "AGENTS.md",
        "merge": "composite"
      }
    ]
  },

  "windsurf": {
    "name": "Windsurf",
    "rootDir": ".windsurf",
    "export": [
      {
        "from": "rules/**/*.md",
        "to": ".windsurf/rules/**/*.md"
      }
    ],
    "import": [
      {
        "from": ".windsurf/rules/**/*.md",
        "to": "rules/**/*.md"
      }
    ]
  }
}
